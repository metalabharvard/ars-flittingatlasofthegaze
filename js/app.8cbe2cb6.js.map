{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/scripts/bin2d.js","webpack:///./src/scripts/index.js"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","0","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","d3_binX","d3_binY","colors","globalState","cat","loader","d3","widget","w","node","clientWidth","h","clientHeight","globalDispatch","on","images","update","preventDefault","togglestate","console","log","toggleNav","remove","rootDOM","append","attr","rangeX","rangeY","scaleX","domain","range","scaleY","gaze","img","cursor","setImage","imgDOM","cursorDOM","yaw","pitch","arr","Array","len","taken","RangeError","x","Math","floor","random","getRandom","nearby","tData","filter","style","getByYawPitch","iObj","imageid","imageobj","src","html","object_title","object_artist","object_century","object_classification","this","y","round","invert","svg","selectAll","svgEnter","enter","merge","plot","plotImages","renderGaze","dataBinned","side","dx","dy","width","height","bin","points","binsById","forEach","point","py","pj","trunc","px","pi","id","square","_","arguments","sidel","join","size","bin2d","dataTrans","map","binTrans","binData","globeRadius","scaleR","proj","scale","translate","clipAngle","circle","path","projection","graticule","step","datum","groups","groupsEnter","select","center","radius","exit","renderDistribution","categories","v","a","indexOf","unshift","menu","menuEnter","menuItems","menuItemsEnter","classed","text","renderCategoryMenu","unpackedData","container","containerEnter","faces","facesEnter","renderBinContents","url","object_id","object_department","object_division","object_datebegin","object_culture","object_provenance","object_dimensions","object_medium","object_technique","object_accessionyear","then","async","imageIds","bar","imageCount","currentCount","promiseArray","imageArray","imageId","Promise","resolve","Image","onload","all","loadImages","onresize"],"mappings":"aACE,SAASA,EAAqBC,GAQ7B,IAPA,IAMIC,EAAUC,EANVC,EAAWH,EAAK,GAChBI,EAAcJ,EAAK,GACnBK,EAAiBL,EAAK,GAIHM,EAAI,EAAGC,EAAW,GACpCD,EAAIH,EAASK,OAAQF,IACzBJ,EAAUC,EAASG,GAChBG,OAAOC,UAAUC,eAAeC,KAAKC,EAAiBX,IAAYW,EAAgBX,IACpFK,EAASO,KAAKD,EAAgBX,GAAS,IAExCW,EAAgBX,GAAW,EAE5B,IAAID,KAAYG,EACZK,OAAOC,UAAUC,eAAeC,KAAKR,EAAaH,KACpDc,EAAQd,GAAYG,EAAYH,IAKlC,IAFGe,GAAqBA,EAAoBhB,GAEtCO,EAASC,QACdD,EAASU,OAATV,GAOD,OAHAW,EAAgBJ,KAAKK,MAAMD,EAAiBb,GAAkB,IAGvDe,IAER,SAASA,IAER,IADA,IAAIC,EACIf,EAAI,EAAGA,EAAIY,EAAgBV,OAAQF,IAAK,CAG/C,IAFA,IAAIgB,EAAiBJ,EAAgBZ,GACjCiB,GAAY,EACRC,EAAI,EAAGA,EAAIF,EAAed,OAAQgB,IAAK,CAC9C,IAAIC,EAAQH,EAAeE,GACG,IAA3BX,EAAgBY,KAAcF,GAAY,GAE3CA,IACFL,EAAgBQ,OAAOpB,IAAK,GAC5Be,EAASM,EAAoBA,EAAoBC,EAAIN,EAAe,KAItE,OAAOD,EAIR,IAAIQ,EAAmB,GAKnBhB,EAAkB,CACrBiB,EAAG,GAGAZ,EAAkB,GAGtB,SAASS,EAAoB1B,GAG5B,GAAG4B,EAAiB5B,GACnB,OAAO4B,EAAiB5B,GAAU8B,QAGnC,IAAIC,EAASH,EAAiB5B,GAAY,CACzCK,EAAGL,EACHgC,GAAG,EACHF,QAAS,IAUV,OANAhB,EAAQd,GAAUW,KAAKoB,EAAOD,QAASC,EAAQA,EAAOD,QAASJ,GAG/DK,EAAOC,GAAI,EAGJD,EAAOD,QAKfJ,EAAoBO,EAAInB,EAGxBY,EAAoBQ,EAAIN,EAGxBF,EAAoBS,EAAI,SAASL,EAASM,EAAMC,GAC3CX,EAAoBY,EAAER,EAASM,IAClC5B,OAAO+B,eAAeT,EAASM,EAAM,CAAEI,YAAY,EAAMC,IAAKJ,KAKhEX,EAAoBgB,EAAI,SAASZ,GACX,oBAAXa,QAA0BA,OAAOC,aAC1CpC,OAAO+B,eAAeT,EAASa,OAAOC,YAAa,CAAEC,MAAO,WAE7DrC,OAAO+B,eAAeT,EAAS,aAAc,CAAEe,OAAO,KAQvDnB,EAAoBoB,EAAI,SAASD,EAAOE,GAEvC,GADU,EAAPA,IAAUF,EAAQnB,EAAoBmB,IAC/B,EAAPE,EAAU,OAAOF,EACpB,GAAW,EAAPE,GAA8B,iBAAVF,GAAsBA,GAASA,EAAMG,WAAY,OAAOH,EAChF,IAAII,EAAKzC,OAAO0C,OAAO,MAGvB,GAFAxB,EAAoBgB,EAAEO,GACtBzC,OAAO+B,eAAeU,EAAI,UAAW,CAAET,YAAY,EAAMK,MAAOA,IACtD,EAAPE,GAA4B,iBAATF,EAAmB,IAAI,IAAIM,KAAON,EAAOnB,EAAoBS,EAAEc,EAAIE,EAAK,SAASA,GAAO,OAAON,EAAMM,IAAQC,KAAK,KAAMD,IAC9I,OAAOF,GAIRvB,EAAoB2B,EAAI,SAAStB,GAChC,IAAIM,EAASN,GAAUA,EAAOiB,WAC7B,WAAwB,OAAOjB,EAAgB,SAC/C,WAA8B,OAAOA,GAEtC,OADAL,EAAoBS,EAAEE,EAAQ,IAAKA,GAC5BA,GAIRX,EAAoBY,EAAI,SAASgB,EAAQC,GAAY,OAAO/C,OAAOC,UAAUC,eAAeC,KAAK2C,EAAQC,IAGzG7B,EAAoB8B,EAAI,GAExB,IAAIC,EAAaC,OAAqB,aAAIA,OAAqB,cAAK,GAChEC,EAAmBF,EAAW5C,KAAKuC,KAAKK,GAC5CA,EAAW5C,KAAOf,EAClB2D,EAAaA,EAAWG,QACxB,IAAI,IAAIvD,EAAI,EAAGA,EAAIoD,EAAWlD,OAAQF,IAAKP,EAAqB2D,EAAWpD,IAC3E,IAAIU,EAAsB4C,EAI1B1C,EAAgBJ,KAAK,CAAC,GAAG,IAElBM,I,+EC3ET,IAAI0C,EAAU,SAAS1B,GAAK,OAAOA,EAAE,IACjC2B,EAAU,SAAS3B,GAAK,OAAOA,EAAE,ICrErC,MAAM4B,EAEY,OAFZA,EAGO,OAHPA,EAIA,OAJAA,EAKQ,OAGd,IAAIC,EAAc,CACjBC,IAAK,OAGN,MAAMC,EAASC,IAAU,WACnBC,EAASD,IAAU,WACnBE,EAAID,EAAOE,OAAOC,YAClBC,EAAIJ,EAAOE,OAAOG,aAMlBC,EAAiBP,IACtB,SACA,cACA,WACA,WACA,cAGDO,EAAeC,GAAG,SAAS,CAAC5E,EAAK6E,MAwHjC,SAAmB7E,EAAK6E,GAEvBC,EAAOV,IAAU,gCAAgCG,OAAOzB,OAEzCsB,IAAa,wBAC1BQ,GAAG,UAAS,WACZR,IAASW,iBACTD,EAAOV,IAAU,gCAAgCG,OAAOzB,UAG1D,SAASgC,EAAOE,GACdC,QAAQC,IAAI,YAAYF,GACL,SAAhBA,EACFL,EAAe/D,KAAK,cAAc,KAAKZ,EAAK6E,GAE7CF,EAAe/D,KAAK,WAAW,KAAKZ,EAAK6E,IAtI3CM,CAAUnF,EAAK6E,KAGhBF,EAAeC,GAAG,cAAc,CAAC5E,EAAK6E,KAwRrCI,QAAQC,IAAI,uBACZd,IAAU,SAASgB,SACnBhB,IAAU,qBAAqBgB,SA0DhC,SAAoBpF,EAAM6E,GACzBI,QAAQC,IAAI,cACX,MAGKG,EAAUhB,EACVhD,EAAS+C,IAAU,WACvBkB,OAAO,OACPC,KAAK,KAAK,cAENC,EAAS,EAAE,GAAG,IACdC,EAAS,EAAE,GAAG,IAEdC,EAAStB,MAAiBuB,OAAOH,GAAQI,MAAM,CAAC,EAAGtB,IACnDuB,EAASzB,MAAiBuB,OAAOF,GAAQG,MAAM,CAACnB,EAAG,IAEnDqB,EAAOT,EAAQC,OAAO,OAC1BC,KAAK,KAAK,QACNQ,EAAMD,EAAKR,OAAO,OACtBC,KAAK,KAAK,OACVD,OAAO,OACHU,EAASF,EAAKR,OAAO,OACzBC,KAAK,KAAK,UAsDZ,SAASU,EAASC,EAAOC,EAAUC,EAAIC,EAAMrG,EAAK6E,GAEjD,IACIvE,EAmDN,SAAmBgG,EAAKhD,GACvB,IAAIjC,EAAS,IAAIkF,MAAMjD,GACtBkD,EAAMF,EAAI9F,OACViG,EAAQ,IAAIF,MAAMC,GACnB,GAAIlD,EAAIkD,EACP,MAAM,IAAIE,WAAW,iDACtB,KAAOpD,KAAK,CACX,IAAIqD,EAAIC,KAAKC,MAAMD,KAAKE,SAAWN,GACnCnF,EAAOiC,GAAKgD,EAAIK,KAAKF,EAAQA,EAAME,GAAKA,GACxCF,EAAME,KAAOH,KAAOC,EAAQA,EAAMD,GAAOA,EAE1C,OAAOnF,EA9DE0F,CASR,SAAuBZ,EAAUC,EAAIC,EAAMrG,GA0B1C,OAxBA,SAASgH,EAAOpB,EAAQ,GAEvB,IAAIqB,EAAQjH,EAAKkH,OAChB9E,GACEA,EAAEgE,IAAOA,EAAMR,GACdxD,EAAEgE,IAAOA,EAAMR,GACfxD,EAAEiE,MAASA,EAAST,EAAM,GAC1BxD,EAAEiE,MAASA,EAAST,EAAM,GAE9B,GAAIqB,EAAMzG,OAAS,EAAE,CACpB,IAAI8C,EAAIsC,EAAM,EAQd,OAJAO,EAAUgB,MAAM,QAAWzB,EAAS,EAAFpC,EAAMkC,EAAO,IAAtB,MACvB2B,MAAM,cAAiBzB,EAAOpC,EAAIkC,EAAO,IAAI,GAAG,EAA3B,MACrB2B,MAAM,SAAYtB,EAAOJ,EAAO,GAAO,EAAFnC,GAArB,MAChB6D,MAAM,aAAiBtB,EAAOJ,EAAO,GAAGnC,GAAG,EAAvB,MACf2D,EAGR,OAAOD,EAAOpB,EAAQ,GAGhBoB,GApCQI,CAAcjB,EAAUC,EAAIC,EAAMrG,GACtB,GAAG,GAC3BqH,EAAOxC,EAAOqC,OAAO9E,GAAGA,EAAEkF,UAAYhH,EAAEgH,SAAS,GAAGC,SACxDrB,EAAO3B,OAAOiD,IAAMH,EAAKG,IACzBnG,EAAOoG,KAAM,MAAKnH,EAAEoH,+BACbpH,EAAEqH,4BACFrH,EAAEsH,kDAECtH,EAAEuH,6BA/Db5B,EAASF,EAAIC,EAAO,EAAE,EAAEhG,EAAK6E,GAC7BQ,EAAQT,GAAG,aAAY,WACtB,IAAI+B,EAAIvC,IAAS0D,MAAM,GACnBC,EAAI3D,IAAS0D,MAAM,GACnB1B,EAAMQ,KAAKoB,MAAMtC,EAAOuC,OAAOtB,IAC/BN,EAAQO,KAAKoB,MAAMnC,EAAOoC,OAAOF,IACrC/B,EAAOmB,MAAM,OAAUR,EAAF,MAASQ,MAAM,MAASY,EAAF,MAC3C9B,EAASF,EAAIC,EAAOI,EAAIC,EAAMrG,EAAK6E,MAKpC,SAAoBQ,EAAQrF,GAE3B,MAAMkI,EAAM7C,EAAQ8C,UAAU,OAC5BnI,KAAK,CAAC,IAEFoI,EAAWF,EAAIG,QACnB/C,OAAO,OAET4C,EAAII,MAAMF,GACR7C,KAAK,UAAY,OAAMjB,KAAKG,KAE9B,MAAM8D,EAAOL,EAAII,MAAMF,GAEvBG,EAAKjD,OAAO,QACVC,KAAK,KAAKG,GAAQ,KAClBH,KAAK,KAAKM,EAAO,IACjBN,KAAK,KAAKG,EAAO,KACjBH,KAAK,KAAKM,EAAO,IACjBN,KAAK,SAAS,OACdA,KAAK,UAAU,IAEjBgD,EAAKjD,OAAO,QACVC,KAAK,KAAKG,EAAO,IACjBH,KAAK,KAAKM,EAAO,KACjBN,KAAK,KAAKG,EAAO,IACjBH,KAAK,KAAKM,GAAQ,KAClBN,KAAK,SAAS,OACdA,KAAK,UAAU,IAEjBgD,EAAKJ,UAAU,QACbnI,KAAKA,GACLqI,QACA/C,OAAO,UACPC,KAAK,IAlEG,GAmERA,KAAK,OAAO,SACZA,KAAK,UAAU,IACfA,KAAK,KAAKnD,GAAGsD,EAAOtD,EAAEgE,MACtBb,KAAK,KAAKnD,GAAGyD,EAAOzD,EAAEiE,QAvCzBmC,CAAW1C,EAAK9F,GAnXhByI,CAAWzI,EAAK6E,KAGjBF,EAAeC,GAAG,WAAY,CAAC5E,EAAK6E,KACnCI,QAAQC,IAAI,WAAWjB,EAAYC,KAucnCe,QAAQC,IAAI,eACZd,IAAU,SAASgB,SACnBhB,IAAU,eAAegB,SAjS1B,SAA4BpF,EAAK6E,GAChCI,QAAQC,IAAI,sBAEZ,MAQMwD,EA7FP,SAAiB1I,GAEhB,MAAM0I,EDnIA,WACL,IAEIC,EACAC,EACAC,EAJAC,EAAQ,EACRC,EAAS,EAITpC,EAAI7C,EACJiE,EAAIhE,EAER,SAASiF,EAAIC,GACX,IAAIC,EAAW,GAkBf,OAhBAD,EAAOE,SAAQ,SAASC,EAAO9I,GAC7B,IAAI+I,EAAKtB,EAAEnH,KAAKoI,EAAKI,EAAO9I,GAAKuI,EAC7BS,EAAK1C,KAAK2C,MAAMF,GAChBG,EAAK7C,EAAE/F,KAAKoI,EAAKI,EAAO9I,GAAKsI,EAC7Ba,EAAK7C,KAAK2C,MAAMC,GAEhBE,EAAKD,EAAK,IAAMH,EAChBN,EAAME,EAASQ,GACfV,EAAKA,EAAIlI,KAAKsI,KAChBJ,EAAME,EAASQ,GAAM,CAACN,IAClB9I,EAAImJ,EACRT,EAAIxH,EAAI8H,EACRN,EAAIrC,EAAI8C,EAAKb,EACbI,EAAIjB,EAAIuB,EAAKT,MAGVzE,IAAU8E,GAGnB,SAASS,EAAOhB,GAGZ,MAAO,CAFAA,EACEA,GAoCb,OAhCAK,EAAIrC,EAAI,SAASiD,GACf,OAAKC,UAAUrJ,QACfmG,EAAIiD,EACGZ,GAFuBrC,GAKhCqC,EAAIjB,EAAI,SAAS6B,GACf,OAAKC,UAAUrJ,QACfuH,EAAI6B,EACGZ,GAFuBjB,GAKhCiB,EAAIW,OAAS,SAASG,GAEpB,OADID,UAAUrJ,OAAS,IAAGmI,EAAOmB,GAC1B,IAAMH,EAAOG,GAAOC,KAAK,KAAO,KAIzCf,EAAIgB,KAAO,SAASJ,GAClB,OAAKC,UAAUrJ,QACfsI,GAASc,EAAE,GAAIb,GAAUa,EAAE,GACpBZ,GAFuB,CAACF,EAAOC,IAKxCC,EAAIL,KAAO,SAASiB,GAClB,OAAKC,UAAUrJ,QAEfoI,EADAD,GAAQiB,EAERf,EAAKF,EACEK,GAJuBL,GAOzBK,EAAIL,KAAK,GC8DEsB,GAChBD,KAAK,CAAC,IAAK,MACXrB,KAAK,IAEFuB,EAAYlK,EAAKmK,IAAI/H,GACnB,CAACA,EAAEgE,IAAM,IAAKhE,EAAEiE,MAAQ,GAAIjE,IAGpC,IAAIgI,EAAW1B,EAAWwB,GAO1B,OALgBE,EAASD,IAAI/H,IAC5BA,EAAEuE,EAAIvE,EAAEuE,EAAI,IACZvE,EAAE2F,EAAI3F,EAAE2F,EAAI,GACL3F,IA8EYiI,CAPM,QAApBpG,EAAYC,IACRlE,EAEAA,EAAKkH,OAAO9E,GAAGA,EAAEyF,wBAA0B5D,EAAYC,MAM3DoG,EAAchG,EAAI,EAGlB4D,EAAM7D,EAAO8D,UAAU,OAC3BnI,KAAK,CAAC,IAEFoI,EAAWF,EAAIG,QAClB/C,OAAO,OACPC,KAAK,KAAK,QAEb2C,EAAII,MAAMF,GACP7C,KAAK,UAAY,OAAMjB,KAAKG,KAE/B,MAAM8D,EAAOL,EAAII,MAAMF,GAGjBmC,EAASnG,MACZuB,OAAO,CAAC,EAAEvB,IAAOsE,EAAWtG,GAAGA,EAAE5B,UACjCoF,MAAM,CAAC,EAAG,IAEP4E,EAAOpG,MACXqG,MAAMH,GACNI,UAAU,CAACpG,EAAE,EAAGG,EAAE,IAClBkG,UAAU,IACNC,EAASxG,MACTyG,EAAOzG,MACX0G,WAAWN,GACPO,EAAY3G,MAChB4G,KAAK,CAAC,GAAI,KAEZzC,EAAKjD,OAAO,UACVC,KAAK,KAAKjB,EAAE,GACZiB,KAAK,KAAKd,EAAE,GACZc,KAAK,IAAI+E,GACT/E,KAAK,OAAO,SAEKgD,EAAKjD,OAAO,QAC7B2F,MAAMF,GACNxF,KAAK,QAAS,aACdA,KAAK,IAAKsF,GACVtF,KAAK,OAAO,QACZA,KAAK,SAASvB,GALhB,MAQMkH,EAAS3C,EAAKJ,UAAU,QAC5BnI,KAAK0I,EAAYtG,GAAGA,EAAEkF,SAGlB6D,EAAcD,EAAO7C,QACzB/C,OAAO,KACPC,KAAK,QAAQ,OAEf4F,EAAY7F,OAAO,QACjBC,KAAK,QAAQ,cAEf4F,EAAY7F,OAAO,QACjBC,KAAK,QAAQ,WAGf2F,EAAO5C,MAAM6C,GACX5F,KAAK,aAAa,CAACnD,EAAE9B,IAAIA,GACvBsE,GAAG,aAAa,SAASxC,GAC5BuC,EAAe/D,KAAK,WAAW,KAAKwB,EAAEyC,GACnCT,IAAU0D,MAAMsD,OAAO,YAAY7F,KAAK,OAAOvB,MAElDY,GAAG,YAAY,SAASxC,GACvBuC,EAAe/D,KAAK,cAClBwD,IAAU0D,MAAMsD,OAAO,YAAY7F,KAAK,OAAOvB,MAE/CY,GAAG,SAAS,SAASxC,GACvBuC,EAAe/D,KAAK,WAAW,KAAKwB,EAAEyC,MAGxCqG,EAAO5C,MAAM6C,GACXC,OAAO,eACP7F,KAAK,IAAMnD,GAAIyI,EACfD,EAAOS,OAAO,CAACjJ,EAAEuE,EAAEvE,EAAE2F,IAAIuD,OAAOf,EAAOnG,IAAOsE,EAAWtG,GAAGA,EAAE5B,SAA9DoK,KAEArF,KAAK,OAAOvB,GACZuB,KAAK,UAAU,GAEjB2F,EAAO5C,MAAM6C,GACXC,OAAO,YACN7F,KAAK,IAAMnD,GAAIyI,EACfD,EAAOS,OAAO,CAACjJ,EAAEuE,EAAEvE,EAAE2F,IAAIuD,OAAOf,EAAOnI,EAAE5B,QAAzCoK,KAEDrF,KAAK,OAAOvB,GAGdkH,EAAOK,OAAOnG,SA5QdoG,CAAmBxL,EAAK6E,GAoIzB,SAA4B7E,EAAK6E,GAChCI,QAAQC,IAAI,sBACZ,MAAMG,EAAUjB,IAAU,WACpBqH,EAAazL,EAAKmK,IAAI/H,GACnBA,EAAEyF,uBAETX,OAAO,CAACwE,EAAGpL,EAAGqL,IAAIA,EAAEC,QAAQF,KAAKpL,GACnCmL,EAAWI,QAAQ,OAEnB,MAAMC,EAAOzG,EACX8C,UAAU,aACVnI,KAAK,CAAC,IACF+L,EAAYD,EAAKzD,QACrB/C,OAAO,MACPC,KAAK,QAAQ,YACfuG,EAAKxD,MAAMyD,GACX,MAAMC,EAAYF,EAAKxD,MAAMyD,GAC3B5D,UAAU,QACVnI,KAAKyL,GACDQ,EAAiBD,EAAU3D,QAC/B/C,OAAO,MACPC,KAAK,QAAQ,OACfyG,EAAU1D,MAAM2D,GACd1G,KAAK,YAAYnD,GAAGA,GACpB8J,QAAQ,SAAS9J,GAAG6B,EAAYC,MAAQ9B,GACxC+J,KAAK/J,GAAGA,GACRwC,GAAG,SAAS,WACZR,IAASW,iBACT,IAAIb,EAAME,IAAU0D,MAAMvC,KAAK,aAC/BtB,EAAYC,IAAMA,EAClBS,EAAe/D,KAAK,WAAY,KAAMZ,EAAK6E,MAjK7CuH,CAAmBpM,EAAK6E,KAGzBF,EAAeC,GAAG,WAAW,CAACoE,EAAInE,MAiRlC,SAA2B7E,EAAM6E,GAChCI,QAAQC,IAAI,qBAEZ,MAAMG,EAAUjB,IAAU,WAEpBiI,EAAerM,EAAKmK,IAAI/H,GAAGA,EAAE,IAG7BkK,EAAYjH,EAAQ8C,UAAU,gBAClCnI,KAAK,CAAC,IAEFuM,EAAiBD,EAAUjE,QAC9B/C,OAAO,OACPC,KAAK,KAAK,eAKPiH,EAHMF,EAAUhE,MAAMiE,GAGVpE,UAAU,SAC1BnI,KAAKqM,GAEDI,EAAaD,EAAMnE,QACvB/C,OAAO,OACPC,KAAK,QAAQ,QACfkH,EAAWnH,OAAO,OAChBC,KAAK,QAAQ,YACfkH,EAAWnH,OAAO,KAChBC,KAAK,QAAQ,gBAGfiH,EAAMlE,MAAMmE,GACVlH,KAAK,aAAanD,GAAGA,EAAEkF,SACzBkF,EAAMlE,MAAMmE,GACVrB,OAAO,aACP7F,KAAK,MAAMnD,GACAyC,EAAOqC,OAAO1F,GAAGA,EAAE8F,UAAYlF,EAAEkF,SAAS,GAAGC,SAC5CC,KAEdgF,EAAMlE,MAAMmE,GACVrB,OAAO,iBACPe,KAAK/J,GAAGA,EAAEkF,SAGZkF,EAAMjB,OAAOnG,SA3TbsH,CAAkB1D,EAAInE,KAGvBF,EAAeC,GAAG,aAAa,KA4T9BK,QAAQC,IAAI,sBACZd,IAAU,gBAAgBgB,WArTPhB,IAAO,+BA6C3B,SAAmBhC,GAClB,MAAO,CACNkF,QAASlF,EAAEkF,QACXqF,IAAKvK,EAAEuK,IACPtG,OAAQjE,EAAEiE,MACVD,KAAMhE,EAAEgE,IACRwG,UAAWxK,EAAEwK,UACblF,aAActF,EAAEsF,aAChBG,sBAAuBzF,EAAEyF,sBACzBgF,kBAAmBzK,EAAEyK,kBACrBC,gBAAiB1K,EAAE0K,gBACnBnF,cAAevF,EAAEuF,cACjBC,eAAgBxF,EAAEwF,eAClBmF,iBAAkB3K,EAAE2K,iBACpBC,eAAgB5K,EAAE4K,eAClBC,kBAAmB7K,EAAE6K,kBACrBC,kBAAmB9K,EAAE8K,kBACrBC,cAAe/K,EAAE+K,cACjBC,iBAAkBhL,EAAEgL,iBACpBC,sBAAuBjL,EAAEiL,yBA9DfC,KAAKtN,KAiBjBuN,eAA0BC,GACzB,MAAMC,EAAMtJ,EAAOiH,OAAO,iBACpBsC,EAAaF,EAAShN,OAC5B,IAAImN,EAAe,EACnB,MAAMC,EAAe,GACfC,EAAa,GACnB,IAAK,IAAIC,KAAWN,EACnBI,EAAa9M,KAAK,IAAIiN,QAAQC,IAC7B,MAAMjI,EAAM,IAAIkI,MAChBlI,EAAImI,OAAS,WACZP,IACAF,EAAItG,MAAM,QAAWP,KAAKoB,MAAM2F,EAAeD,EAAa,KAAzC,KACnBM,KAEDjI,EAAIyB,IAAO,gBAAesG,QAC1BD,EAAW/M,KAAK,CAACwG,QAAQwG,EAAQvG,SAASxB,OAM5C,aAFMgI,QAAQI,IAAIP,GAClBzJ,EAAOiB,SACAyI,GAnCeO,CADLpO,EAAKmK,IAAI/H,GAAGA,EAAEkF,UAGjBgG,KAAMzI,IACnBF,EAAe/D,KAAK,SAAS,KAAKZ,EAAK6E,GAExClB,OAAO0K,SAAW,WAChBjK,IAAU,SAASgB,SACnBhB,IAAU,SAASgB,SACnBhB,IAAU,eAAegB,SACzBT,EAAe/D,KAAK,SAAS,KAAKZ,EAAK6E","file":"js/app.8cbe2cb6.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t0: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([48,1]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","import * as d3 from \"d3\";\r\n\r\n\r\n\r\nexport function bin2d() {\r\n  var width = 1,\r\n      height = 1,\r\n      side,\r\n      dx,\r\n      dy,\r\n      x = d3_binX,\r\n      y = d3_binY;\r\n\r\n  function bin(points) {\r\n    var binsById = {};\r\n\r\n    points.forEach(function(point, i) {\r\n      var py = y.call(bin, point, i) / dy;\r\n      var pj = Math.trunc(py);\r\n      var px = x.call(bin, point, i) / dx;\r\n      var pi = Math.trunc(px);\r\n\r\n      var id = pi + \"-\" + pj;\r\n      var bin = binsById[id];\r\n      if (bin) bin.push(point); else {\r\n        bin = binsById[id] = [point];\r\n        bin.i = pi;\r\n        bin.j = pj;\r\n        bin.x = pi * dx;\r\n        bin.y = pj * dy;\r\n      }\r\n    });\r\n    return d3.values(binsById);\r\n  }\r\n\r\n  function square(side) {\r\n    var dx = side,\r\n          dy = side;\r\n      return [dx, dy];\r\n  }\r\n\r\n  bin.x = function(_) {\r\n    if (!arguments.length) return x;\r\n    x = _;\r\n    return bin;\r\n  };\r\n\r\n  bin.y = function(_) {\r\n    if (!arguments.length) return y;\r\n    y = _;\r\n    return bin;\r\n  };\r\n\r\n  bin.square = function(sidel) {\r\n    if (arguments.length < 1) side = sidel;\r\n    return \"m\" + square(sidel).join(\"l\") + \"z\";\r\n  };\r\n\r\n\r\n  bin.size = function(_) {\r\n    if (!arguments.length) return [width, height];\r\n    width = +_[0], height = +_[1];\r\n    return bin;\r\n  };\r\n\r\n  bin.side = function(_) {\r\n    if (!arguments.length) return side;\r\n    side = +_;\r\n    dx = side;\r\n    dy = side;\r\n    return bin;\r\n  };\r\n\r\n  return bin.side(1);\r\n};\r\n\r\nvar d3_binX = function(d) { return d[0]; },\r\n    d3_binY = function(d) { return d[1]; };\r\n\r\n\r\n","import '../styles/index.scss';\nimport * as d3 from 'd3';\nimport {bin2d} from './bin2d';\n\n\n\n// globals\n\nconst colors = {\n\tplotBackground: '#333',\n\tglobeBackground: '#000',\n\tgraticules: '#333',\n\tbin: '#fff',\n\tbinSelected: '#f00'\n}\n\nlet globalState = {\n\tcat: \"All\"\n}\n\nconst loader = d3.select(\"#loader\");\nconst widget = d3.select(\"#widget\");\nconst w = widget.node().clientWidth;\nconst h = widget.node().clientHeight;\n\n\n\n// dispatch\n\nconst globalDispatch = d3.dispatch(\n\t'toggle',\n\t'gaze:finder',\n\t'dist:cat',\n\t'dist:bin',\n\t'dist:clear'\n);\n\nglobalDispatch.on('toggle',(data,images)=>{\n\ttoggleNav(data,images);\n});\n\nglobalDispatch.on('gaze:finder',(data,images)=>{\n\tdestroyDistribution();\n\trenderGaze(data,images);\n});\n\nglobalDispatch.on('dist:cat', (data,images)=>{\n\tconsole.log(\"dist:cat\",globalState.cat);\n\tdestroyGaze();\n\trenderDistribution(data,images);\n\trenderCategoryMenu(data,images);\n});\n\nglobalDispatch.on('dist:bin',(bin,images)=>{\n\trenderBinContents(bin,images);\n});\n\nglobalDispatch.on('dist:clear',()=>{\n\tdestroyBinContents();\n});\n\n\n\n// data ---------------------------------------------------\n\nconst dataPromise = d3.csv('./public/data/temp_data.csv', parseData);\n\ndataPromise.then(data=>{\n\t\n\tconst imageIds = data.map(d=>d.imageid);\n\tconst imagesPromise = loadImages(imageIds)\n\t\n\timagesPromise.then((images)=>{\n\t\tglobalDispatch.call('toggle',null,data,images);\n\n\twindow.onresize = function(){\n\t\t\td3.select(\"#gaze\").remove();\n\t\t\td3.select(\"#dist\").remove();\n\t\t\td3.select(\"#gazeResult\").remove();\n\t\t\tglobalDispatch.call('toggle',null,data,images);\n\t\t}\n\t})\n});\n\nasync function loadImages(imageIds) {\n\tconst bar = loader.select(\".progress_bar\");\n\tconst imageCount = imageIds.length;\n\tlet currentCount = 0;\n\tconst promiseArray = []; \n\tconst imageArray = []; \n\tfor (let imageId of imageIds) {\n\t\tpromiseArray.push(new Promise(resolve => {\n\t\t\tconst img = new Image();\n\t\t\timg.onload = function() {\n\t\t\t\tcurrentCount++;\n\t\t\t\tbar.style(\"width\",`${Math.round(currentCount / imageCount * 100)}%`)\n\t\t\t\tresolve();\n\t\t\t};\n\t\t\timg.src = `./public/img/${imageId}.jpg`;\n\t\t\timageArray.push({imageid:imageId,imageobj:img});\n\t\t}));\n\t}\n\t// wait for all the images to be loaded\n\tawait Promise.all(promiseArray); \n\tloader.remove();\n\treturn imageArray;\n}\n\n\n\nfunction parseData(d){\n\treturn {\n\t\timageid: d.imageid,\n\t\turl: d.url,\n\t\tpitch: +d.pitch,\n\t\tyaw: +d.yaw,\n\t\tobject_id: d.object_id,\n\t\tobject_title: d.object_title,\n\t\tobject_classification: d.object_classification,\n\t\tobject_department: d.object_department,\n\t\tobject_division: d.object_division,\n\t\tobject_artist: d.object_artist,\n\t\tobject_century: d.object_century,\n\t\tobject_datebegin: d.object_datebegin,\n\t\tobject_culture: d.object_culture,\n\t\tobject_provenance: d.object_provenance,\n\t\tobject_dimensions: d.object_dimensions,\n\t\tobject_medium: d.object_medium,\n\t\tobject_technique: d.object_technique,\n\t\tobject_accessionyear: +d.object_accessionyear\n\t}\n}\n\nfunction binData(data){\n\t// set up bin function\n\tconst dataBinned = bin2d()     \n\t\t\t.size([360, 180]) // degrees of globe\n\t\t\t.side(18); \n\t// negative range of 3d coords won't work with 2dbin, so make all positive\n\tconst dataTrans = data.map(d=>{\n\t\treturn [d.yaw + 180, d.pitch + 90, d]; // add original data in 3rd slot\n\t});\n\t// generat dataBinned\n\tlet binTrans = dataBinned(dataTrans);\n\t// move back to original range\n\tconst binData = binTrans.map(d=>{\n\t\td.x = d.x - 180;\n\t\td.y = d.y - 90;\n\t\treturn d;\n\t});\n\treturn binData;\n}\n\n\n\n// nav\n\nfunction toggleNav(data,images){\n\n\tupdate(d3.select(\"input[name='toggle']:checked\").node().value);\n\n\tconst toggle = d3.selectAll(\"input[name='toggle']\")\n\t\t.on(\"change\",function(){\n\t\t\td3.event.preventDefault();\n\t\t\tupdate(d3.select(\"input[name='toggle']:checked\").node().value);\n\t\t});\n\n\tfunction update(togglestate){\n\t \tconsole.log(\"toggstate\",togglestate);\n\t\tif (togglestate === 'gaze') {\n\t\t \tglobalDispatch.call('gaze:finder',null,data,images);\n\t\t} else {\n\t\t\tglobalDispatch.call('dist:cat',null,data,images);\n\t\t}\n\t}\n}\n\n\n\n// distibution --------------------------------------------\n\nfunction renderCategoryMenu(data,images){\n\tconsole.log(\"renderCategoryMenu\");\n\tconst rootDOM = d3.select('#filter')\n\tconst categories = data.map(d=>{\n\t\t\treturn d.object_classification;\n\t\t})\n\t\t.filter((v, i, a)=>a.indexOf(v)===i)\n\tcategories.unshift(\"All\");\n\n\tconst menu = rootDOM\n\t\t.selectAll('.tab-menu')\n\t\t.data([1]);\n\tconst menuEnter = menu.enter()\n\t\t.append('ul')\n\t\t.attr(\"class\",\"tab-menu\");\n\tmenu.merge(menuEnter)\n\tconst menuItems = menu.merge(menuEnter)\n\t\t.selectAll('.tab')\n\t\t.data(categories)\n\tconst menuItemsEnter = menuItems.enter()\n\t\t.append(\"li\")\n\t\t.attr(\"class\",\"tab\")\n\tmenuItems.merge(menuItemsEnter)\n\t\t.attr(\"data-link\",d=>d)\n\t\t.classed(\"active\",d=>globalState.cat === d)\n\t\t.text(d=>d)\n\t\t.on(\"click\", function(){\n\t\t\td3.event.preventDefault();\n\t\t\tlet cat = d3.select(this).attr(\"data-link\");\n\t\t\tglobalState.cat = cat;\n\t\t\tglobalDispatch.call('dist:cat', null, data,images);\n\t\t});\n}\n\nfunction renderDistribution(data,images){\n\tconsole.log(\"renderDistribution\");\n\n\tconst filteredData = (function(){\n\t\t\tif (globalState.cat === \"All\") {\n\t\t\t\treturn data;\n\t\t\t} else {\n\t\t\t\treturn data.filter(d=>d.object_classification === globalState.cat)\n\t\t\t}\n\t\t})();\n\n\tconst\tdataBinned =  binData(filteredData);\n\t\n\tconst globeRadius = w / 2;\n\t\n\t// update\n\tconst svg = widget.selectAll('svg')\n\t\t.data([1]);\n\t// enter\n\tconst svgEnter = svg.enter()\n\t \t.append('svg')\n\t \t.attr(\"id\",\"dist\")\n\t// update + enter\n\tsvg.merge(svgEnter)\n\t \t.attr(\"viewBox\", `0 0 ${w} ${h}`)\t\n\n\tconst plot = svg.merge(svgEnter)\n\n\t// Scale functions\n\tconst scaleR = d3.scaleLinear()\n\t \t.domain([0,d3.max(dataBinned,d=>d.length)])\n\t \t.range([1, 8]); // range in pixels\n\t// Geo functions\n\tconst proj = d3.geoOrthographic()\n\t\t.scale(globeRadius)\n\t\t.translate([w/2, h/2])\n\t\t.clipAngle(90);\n\tconst circle = d3.geoCircle()\n\tconst path = d3.geoPath()\n\t\t.projection(proj);\n\tconst graticule = d3.geoGraticule()\n\t\t.step([18, 18]);\n\t// Globe background\n\tplot.append(\"circle\")\n\t\t.attr(\"cx\",w/2)\n\t\t.attr(\"cy\",h/2)\n\t\t.attr(\"r\",globeRadius)\n\t\t.attr(\"fill\",\"black\");\n\t// Graticules\n\tconst graticules = plot.append(\"path\")\n\t\t.datum(graticule)\n\t\t.attr(\"class\", \"graticule\")\n\t\t.attr(\"d\", path)\n\t\t.attr(\"fill\",\"none\")\n\t\t.attr(\"stroke\",colors.graticules);\n\n\t// update\n\tconst groups = plot.selectAll(\".bin\")\n\t\t.data(dataBinned, d=>d.imageid);\n\n\t// enter\n\tconst groupsEnter = groups.enter()\n\t\t.append(\"g\")\n\t\t.attr(\"class\",\"bin\")\n\n\tgroupsEnter.append(\"path\")\n\t\t.attr(\"class\",\"bin-target\")\n\t\t\n\tgroupsEnter.append(\"path\")\n\t\t.attr(\"class\",\"bin-dot\")\n\n\t// update + enter\n\tgroups.merge(groupsEnter)\n\t\t.attr(\"data-binid\",(d,i)=>i)\n    .on('mouseover', function(d) {\n\t\tglobalDispatch.call('dist:bin',null,d,images);\n    \td3.select(this).select(\".bin-dot\").attr(\"fill\",colors.binSelected)\n    })\n\t.on('mouseout', function(d) {\n\t\t\tglobalDispatch.call('dist:clear');\n    \td3.select(this).select(\".bin-dot\").attr(\"fill\",colors.bin)\n    })\n    .on('click', function(d) {\n\t\t\tglobalDispatch.call('dist:bin',null,d,images);\n    })\n\n\tgroups.merge(groupsEnter)\n\t\t.select(\".bin-target\")\n\t\t.attr(\"d\", (d)=>path(\n\t\t\tcircle.center([d.x,d.y]).radius(scaleR(d3.max(dataBinned,d=>d.length)))()\n\t\t))\n\t\t.attr(\"fill\",colors.globeBackground)\n\t\t.attr(\"opacity\",0)\n\t\t\n\tgroups.merge(groupsEnter)\n\t\t.select(\".bin-dot\")\n\t\t\t.attr(\"d\", (d)=>path(\n\t\t\t\tcircle.center([d.x,d.y]).radius(scaleR(d.length))()\n\t\t\t))\n\t\t.attr(\"fill\",colors.bin)\n\t\t\n\t// exit\n\tgroups.exit().remove()\n}\n\nfunction destroyDistribution(){\n\tconsole.log(\"destroyDistribution\");\n\td3.select(\"#dist\").remove();\n\td3.select(\"#filter .tab-menu\").remove();\n}\n\nfunction renderBinContents(data, images){\n\tconsole.log(\"renderBinContents\");\n\n\tconst rootDOM = d3.select('#result');\n\n\tconst unpackedData = data.map(d=>d[2])\n\n\t// update\n\tconst container = rootDOM.selectAll('#unpackedBin')\n\t\t.data([1]);\n\t// enter\n\tconst containerEnter = container.enter()\n\t \t.append('div')\n\t \t.attr(\"id\",\"unpackedBin\");\n\t// update + enter\n\tconst div = container.merge(containerEnter)\n\n\t// upadte\n\tconst faces = div.selectAll(\".face\")\n\t\t.data(unpackedData)\n\t// enter\n\tconst facesEnter = faces.enter()\n\t\t.append(\"div\")\n\t\t.attr(\"class\",\"face\")\n\tfacesEnter.append(\"img\")\n\t\t.attr(\"class\",\"face-img\")\n\tfacesEnter.append(\"p\")\n\t\t.attr(\"class\",\"face-caption\")\n\n\t// update + enter\n\tfaces.merge(facesEnter)\n\t\t.attr(\"data-imgid\",d=>d.imageid)\n\tfaces.merge(facesEnter)\n\t\t.select(\".face-img\")\n\t\t.attr(\"src\",d=>{\n\t\t\tlet iObj = images.filter(j=>j.imageid === d.imageid)[0].imageobj;\n\t\t\treturn iObj.src;\n\t\t})\n\tfaces.merge(facesEnter)\n\t\t.select(\".face-caption\")\n\t\t.text(d=>d.imageid)\n\t\n\t// exit\n\tfaces.exit().remove();\n}\n\nfunction destroyBinContents(){\n\tconsole.log(\"destroyBinContents\");\n\td3.select(\"#unpackedBin\").remove();\n}\n\n\n\n// gaze ---------------------------------------------------\n\nfunction renderGaze(data, images){\n\tconsole.log(\"renderGaze\");\n\t\tconst r = 1;\n\t\tconst eyeOffset = -0.1;\n\n\tconst rootDOM = widget;\n\tconst result = d3.select(\"#result\")\n\t\t.append(\"div\")\n\t\t.attr(\"id\",\"gazeResult\");\n\n\tconst rangeX = [-90,90];\n\tconst rangeY = [-50,30];\n\n\tconst scaleX = d3.scaleLinear().domain(rangeX).range([0, w]);\n\tconst scaleY = d3.scaleLinear().domain(rangeY).range([h, 0]);\n\n\tconst gaze = rootDOM.append(\"div\")\n\t\t.attr(\"id\",\"gaze\")\n\tconst img = gaze.append('div')\n\t\t.attr(\"id\",\"img\")\n\t\t.append(\"img\");\n\tconst cursor = gaze.append('div')\n\t\t.attr(\"id\",\"cursor\");\n\tsetImage(img,cursor,0,0,data,images);\n\trootDOM.on(\"mousemove\",function(){\n\t\tlet x = d3.mouse(this)[0];\n\t\tlet y = d3.mouse(this)[1];\n\t\tlet yaw = Math.round(scaleX.invert(x));\n\t\tlet pitch = Math.round(scaleY.invert(y));\n\t\tcursor.style(\"left\",`${x}px`).style(\"top\",`${y}px`);\n\t\tsetImage(img,cursor,yaw,pitch,data,images);\n\t})\n\n\tplotImages(gaze,data);\n\n\tfunction plotImages(rootDOM,data){\n\n\t\tconst svg = rootDOM.selectAll('svg')\n\t\t\t.data([1]);\n\t\t// enter\n\t\tconst svgEnter = svg.enter()\n\t\t\t.append('svg');\n\t\t// update + enter\n\t\tsvg.merge(svgEnter)\n\t\t\t.attr(\"viewBox\", `0 0 ${w} ${h}`)\t\n\n\t\tconst plot = svg.merge(svgEnter);\n\n\t\tplot.append(\"line\")\n\t\t\t.attr(\"x1\",scaleX(-90))\n\t\t\t.attr(\"y1\",scaleY(0))\n\t\t\t.attr(\"x2\",scaleX(90))\n\t\t\t.attr(\"y2\",scaleY(0))\n\t\t\t.attr(\"stroke\",\"red\")\n\t\t\t.attr(\"opacity\",0.5)\n\n\t\tplot.append(\"line\")\n\t\t\t.attr(\"x1\",scaleX(0))\n\t\t\t.attr(\"y1\",scaleY(90))\n\t\t\t.attr(\"x2\",scaleX(0))\n\t\t\t.attr(\"y2\",scaleY(-90))\n\t\t\t.attr(\"stroke\",\"red\")\n\t\t\t.attr(\"opacity\",0.5)\n\t\t\t\n\t\tplot.selectAll(\"face\")\n\t\t\t.data(data)\n\t\t\t.enter()\n\t\t\t.append(\"circle\")\n\t\t\t.attr(\"r\",r)\n\t\t\t.attr(\"fill\",\"white\")\n\t\t\t.attr(\"opacity\",0.5)\n\t\t\t.attr(\"cx\",d=>scaleX(d.yaw))\n\t\t\t.attr(\"cy\",d=>scaleY(d.pitch))\n\t\t\n\t}\n\n\tfunction setImage(imgDOM,cursorDOM,yaw,pitch,data,images){\n\n\t\tlet localData = getByYawPitch(cursorDOM,yaw,pitch,data);\n\t\tlet i = getRandom(localData,1)[0];\n\t\tlet iObj = images.filter(d=>d.imageid === i.imageid)[0].imageobj;\n\t\timgDOM.node().src = iObj.src; // seems to reference the loaded images\n\t\tresult.html(`<b>${i.object_title}</b>\n\t\t\t<br>${i.object_artist}\n\t\t\t<br>${i.object_century}\n\t\t\t<br>&nbsp;\n\t\t\t<br><i>${i.object_classification}</i>`);\n\t\t\t\n\t\tfunction getByYawPitch(cursorDOM,yaw,pitch,data){\n\n\t\t\tfunction nearby(range = 1){\n\t\t\t\t// terminating condition\n\t\t\t\tlet tData = data.filter(\n\t\t\t\t\td=>\n\t\t\t\t\t\t d.yaw > (yaw - range) \n\t\t\t\t\t&& d.yaw < (yaw + range)\n\t\t\t\t\t&& d.pitch > (pitch - (range/2)) \n\t\t\t\t\t&& d.pitch < (pitch + (range/2))\n\t\t\t\t);\n\t\t\t\tif (tData.length > 0){\n\t\t\t\t\tlet n = range+1;\n\n\t\t\t\t\t// TODO: cursor as SVG\n\n\t\t\t\t\tcursorDOM.style(\"width\",`${scaleX(n*2 - rangeX[1])}px`)\n\t\t\t\t\t\t.style(\"margin-left\",`${scaleX(n - rangeX[1])/2*-1}px`)\n\t\t\t\t\t\t.style(\"height\",`${scaleY(rangeY[1] - n*2)}px`)\n\t\t\t\t\t\t.style(\"margin-top\",`${(scaleY(rangeY[1]+n)/2)}px`)\n\t\t\t\t\treturn tData;\n\t\t\t\t}\n\t\t\t\t// recursive condition\n\t\t\t\treturn nearby(range + 1);\n\t\t\t};\n\n\t\t\treturn nearby();\n\t\t}\t\t\n\t\t\t\n\t}\n}\n\nfunction destroyGaze(){\n\tconsole.log(\"destroyGaze\");\n\td3.select(\"#gaze\").remove();\n\td3.select(\"#gazeResult\").remove();\n}\n\n\n\n// util ---------------------------------------------------\n\nfunction getRandom(arr, n) {\n\tvar result = new Array(n),\n\t\tlen = arr.length,\n\t\ttaken = new Array(len);\n\tif (n > len)\n\t\tthrow new RangeError(\"getRandom: more elements taken than available\");\n\twhile (n--) {\n\t\tvar x = Math.floor(Math.random() * len);\n\t\tresult[n] = arr[x in taken ? taken[x] : x];\n\t\ttaken[x] = --len in taken ? taken[len] : len;\n\t}\n\treturn result;\n}\n\n\n"],"sourceRoot":""}